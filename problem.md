问题总结/解决示例
===
## 一个目标
- 一系列讨论的目标其实为：如何将现代前端开发的源码→打包→静态脚本这一套流程正确融入到TFS自动化生成/发布管道以满足CI/CD的要求
## 问题总结
- ### 需要统一的概念
- 前后端分离
  - 这个问题其实在整个讨论过程中一直没有统一概念，现梳理如下：  
    前后端分离可能指三个方面：
    1. 源码分离。这个在讨论中已经被基本否决，因为按照部署单元来说，前后台源码放在两个库中反而不利于版本管理。
    2. 部署分离。这个是之前讨论的重点，这里一个不同的理解可能产生相反的结论：  
       首先一个前提，就是在没有同父域等跨域解决方案的情况下，前后台代码一定会被一起部署，所以这里的分离与否只能指部署的过程是否分离。进入到过程中就有一个顺序的问题，当：  
       - 前台部署先于后台部署时（这也是实际情况）  
         **前台的部署代码会被放入后台静态资源的目录之后再由后代工具被放入包/镜像**（此处也是之前最不明确的点，此处的解耦与否即为实际的部署分离与否）
       - 后台部署先于前台部署  
         这种情况并不切合实际，同时也无法做到真正解耦
    3. 代码宿主分离。这里的意思就是前台html以及脚本与后台服务存放/运行于不同的域下，在没有跨域解决方案时并不实际。  

  由此看出，之前的讨论在黑体部分存在理解不一致，统一之后，暂时想到两种解决方案。依次如下。

## 解决方案

### 利用maven插件  

  maven提供了名为[frontend-maven-plugin](https://github.com/eirslett/frontend-maven-plugin)的插件，用以将前台的构建集成在maven的打包过程中。以本项目的vue为例：
  1. 修改POM.xml添加依赖
  2. 配置插件安装Node、npm/yarn的路径```installDirectory```
  3. 配置插件运行前台构建命令的工作路径```workingDirectory```
  4. 配置Node（Npm）/Yarn安装命令
  5. 配置前台构建命令
  6. 运行maven构建过程，此时前台构建输出无需再进行手工维护，与后台过程解耦。解压maven输出的war包可以看到前台代码已经被部署。  

具体代码配置见提交frontend maven plugin。  
这个思路的问题在于Npm/Yarn与Maven对于错误/警告的侦测不同，有可能导致Npm/Yarn命令没有执行成功而maven却继续构建的情况，想要避免可能还需要从TFS配置方面入手。亦或者指定较为严格的开发流程，让开发人员在提交代码前检查错误（前台的开发环境提供动态的错误检测机制）。

### 利用TFS
这个方法的思路与之前讨论的并没有不同，就是在管道中maven打包之前先运行前台构建脚本，然后将输出文件拷贝至指定位置后再进行maven打包。
